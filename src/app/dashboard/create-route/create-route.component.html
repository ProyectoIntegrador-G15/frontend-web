<div class="delivery-routes-container">
  <!-- Header con botón de regresar y título -->
  <div class="flex items-center mb-6">
    <app-back-button (backClick)="goBack()" class="mr-4"></app-back-button>
    <h1 class="screen-title">Generar ruta de entrega</h1>
  </div>

  <!-- Card principal -->
  <div class="bg-white dark:bg-white/10 m-0 p-0 text-theme-gray dark:text-white/60 text-[15px] rounded-10 relative mb-[25px]">
    <div class="p-[25px]">
      <!-- Campo de Fecha -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-dark dark:text-white mb-2">
          Fecha de la ruta
        </label>
        <nz-date-picker
          [(ngModel)]="selectedDate"
          [nzDisabledDate]="disabledDate"
          nzFormat="dd/MM/yyyy"
          class="w-full"
          nzPlaceHolder="Seleccionar fecha">
        </nz-date-picker>
        <p class="text-xs text-gray-500 mt-1">Solo se pueden seleccionar fechas desde hoy en adelante</p>
      </div>

      <!-- Tabla de pedidos pendientes -->
      <div class="mb-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold text-dark dark:text-white">Pedidos pendientes</h2>
          <span *ngIf="pendingOrders.length > 0" class="text-sm text-gray-500">
            {{ getSelectedOrdersCount() }} de {{ pendingOrders.length }} seleccionados
          </span>
        </div>
        
        <!-- Loading State -->
        <div *ngIf="isLoading" class="flex justify-center items-center py-12">
          <nz-spin nzSimple [nzSize]="'large'"></nz-spin>
        </div>

        <!-- Error State -->
        <div *ngIf="error && !isLoading" class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6">
          <p class="font-medium">{{ error }}</p>
          <button class="mt-2 text-sm underline" (click)="loadData()">Reintentar</button>
        </div>
        
        <!-- Empty State -->
        <div *ngIf="!isLoading && !error && pendingOrders.length === 0" class="text-center py-12">
          <span nz-icon nzType="inbox" nzTheme="outline" class="text-6xl text-gray-300 mb-4"></span>
          <p class="text-gray-500 text-lg">No hay pedidos pendientes</p>
          <p class="text-gray-400 text-sm">Todos los pedidos han sido procesados</p>
        </div>

        <!-- Table -->
        <div *ngIf="!isLoading && !error && pendingOrders.length > 0" class="table-container">
          <table>
            <thead>
              <tr>
                <th>Selección</th>
                <th>ID Pedido</th>
                <th>Cliente</th>
                <th>Dirección</th>
                <th>Fecha de ingreso</th>
                <th>Monto Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let order of paginatedOrders">
                <td class="text-center">
                  <label nz-checkbox 
                         [ngModel]="order.selected"
                         (ngModelChange)="toggleOrderSelection(order.id)">
                  </label>
                </td>
                <td><strong>#{{ order.id }}</strong></td>
                <td>{{ order.clientName }}</td>
                <td>{{ order.clientAddress }}</td>
                <td>{{ formatDate(order.createdAt) }}</td>
                <td><strong>{{ formatCurrency(order.totalAmount) }}</strong></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Paginador de órdenes -->
        <div *ngIf="!isLoading && !error && pendingOrders.length > 0" class="flex justify-center mt-4">
          <nz-pagination 
            [(nzPageIndex)]="currentPage" 
            [nzTotal]="totalItems" 
            [nzPageSize]="pageSize"
            [nzShowSizeChanger]="false" 
            [nzShowQuickJumper]="false">
          </nz-pagination>
        </div>
      </div>

      <!-- Campo Vehículo/Conductor -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-dark dark:text-white mb-2">
          Vehículo/Conductor
        </label>
        <nz-select
          [(ngModel)]="selectedVehicle"
          class="w-full"
          nzPlaceHolder="Seleccionar vehículo">
          <nz-option [nzValue]="1" nzLabel="Asignación automática"></nz-option>
          <nz-option [nzValue]="2" nzLabel="Vehículo 002"></nz-option>
          <nz-option [nzValue]="3" nzLabel="Vehículo 003"></nz-option>
          <nz-option [nzValue]="4" nzLabel="Vehículo 004"></nz-option>
          <nz-option [nzValue]="5" nzLabel="Vehículo 005"></nz-option>
        </nz-select>
        <p class="text-xs text-gray-500 mt-1">Por defecto: Asignación automática</p>
      </div>

      <!-- Botón de generar ruta -->
      <div class="flex justify-center">
        <button class="btn-primary" (click)="generateRoute()">
          <span nz-icon nzType="plus" nzTheme="outline"></span>
          Generar ruta automática
        </button>
      </div>
    </div>
  </div>
</div>