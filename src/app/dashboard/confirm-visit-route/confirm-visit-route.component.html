<div class="confirm-route-container">
  <!-- Header -->
  <div class="flex items-center mb-6">
    <app-back-button (backClick)="goBack()" class="mr-4"></app-back-button>
    <h1 class="screen-title">Confirmar ruta</h1>
  </div>

  <!-- Error Alert -->
  <div *ngIf="error" class="mb-4">
    <nz-alert nzType="error" [nzMessage]="error" nzCloseable (nzOnClose)="error = null"></nz-alert>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <nz-spin nzSimple [nzSize]="'large'"></nz-spin>
    <p class="mt-4 text-gray-500">Geocodificando direcciones...</p>
    <p class="text-xs text-gray-400 mt-2">Esto puede tomar unos segundos</p>
  </div>

  <!-- Content -->
  <div *ngIf="!loading && visitRoute" class="route-content">
    <!-- Layout: Mapa a la izquierda, Tabla a la derecha -->
    <div class="grid grid-cols-2 gap-6 mb-6">
      <!-- Mapa -->
      <div class="map-container">
        <h3 class="subtitle">Mapa de la ruta</h3>
        
        <!-- Mapa Google Maps -->
        <div id="routeMap" class="leaflet-map"></div>
        
        <div class="map-footer">
          <span class="text-xs text-gray-500">
            <span nz-icon nzType="environment" nzTheme="outline"></span>
            {{ visitRoute?.totalClients }} paradas programadas
          </span>
        </div>
      </div>

      <!-- Tabla de paradas -->
      <div class="stops-section">
        <h3 class="subtitle">Ruta</h3>
        
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th style="width: 80px; text-align: center;">#</th>
                <th>Nombre</th>
                <th>Dirección</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let stop of visitRoute.stops">
                <td style="text-align: center;">
                  <span class="stop-number">{{ stop.sequence }}</span>
                </td>
                <td>
                  <p class="font-medium text-dark dark:text-white">{{ stop.clientName }}</p>
                  <p *ngIf="stop.estimatedArrivalTime && stop.estimatedDepartureTime" class="text-xs text-gray-500 mt-1">
                    {{ stop.estimatedArrivalTime.substring(0, 5) }} - {{ stop.estimatedDepartureTime.substring(0, 5) }}
                  </p>
                </td>
                <td>
                  <p class="text-sm text-gray-600 dark:text-gray-400">{{ stop.clientAddress }}</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Botón de confirmación centrado debajo -->
    <div class="flex justify-center mt-6">
      <button 
        class="btn-primary" 
        (click)="confirmRoute()"
        [disabled]="confirming || visitRoute.status !== 'draft'">
        <span *ngIf="!confirming">Confirmar ruta</span>
        <span *ngIf="confirming">
          <nz-spin nzSimple [nzSize]="'small'" class="mr-2"></nz-spin>
          Confirmando...
        </span>
      </button>
    </div>
  </div>
</div>
